@page "/leaderboard-ui"
@model Mywork.Pages.LeaderboardModel
@{
    ViewData["Title"] = "Leaderboard";
}

<h2 class="mt-3 mb-3">排行榜可视化</h2>
<div class="row g-4">
    <!-- 更新 / 增减分 -->
    <div class="col-lg-4">
        <div class="card shadow-sm h-100">
            <div class="card-header">更新 / 增减分</div>
            <div class="card-body">
                <label class="form-label">Customer ID</label>
                <input id="updCustomerId" class="form-control mb-2" type="number" placeholder="如 1001" />
                <label class="form-label">Delta (+/-)</label>
                <input id="updDelta" class="form-control mb-3" type="number" step="0.01" placeholder="[-1000,1000]" />
                <button id="btnUpdate" class="btn btn-primary w-100">提交</button>
                <div class="form-text mt-2">正数加分，负数减分；降到 ≤0 从榜单移除。</div>
            </div>
        </div>
    </div>

    <!-- 区间查询 -->
    <div class="col-lg-4">
        <div class="card shadow-sm h-100">
            <div class="card-header">按排名区间</div>
            <div class="card-body">
                <div class="row g-2">
                    <div class="col-6">
                        <label class="form-label">Start</label>
                        <input id="rangeStart" class="form-control" type="number" value="1" />
                    </div>
                    <div class="col-6">
                        <label class="form-label">End</label>
                        <input id="rangeEnd" class="form-control" type="number" value="10" />
                    </div>
                </div>
                <div class="d-flex gap-2 mt-3">
                    <button id="btnRange" class="btn btn-success flex-fill">查询</button>
                    <button id="btnToggleAuto" class="btn btn-outline-secondary flex-fill" data-on="0">自动刷新: 关</button>
                </div>
                <div class="form-text mt-2">自动刷新间隔 5 秒。</div>
            </div>
        </div>
    </div>

    <!-- 邻居查询 -->
    <div class="col-lg-4">
        <div class="card shadow-sm h-100">
            <div class="card-header">邻居查询</div>
            <div class="card-body">
                <label class="form-label">Customer ID</label>
                <input id="nbCustomerId" class="form-control mb-2" type="number" />
                <label class="form-label">High (上方)</label>
                <input id="nbHigh" class="form-control mb-2" type="number" value="1" />
                <label class="form-label">Low (下方)</label>
                <input id="nbLow" class="form-control mb-3" type="number" value="1" />
                <button id="btnNeighbors" class="btn btn-info w-100 text-white">查询邻居</button>
            </div>
        </div>
    </div>
</div>

<hr class="my-4" />

<div id="msg" class="alert d-none" role="alert"></div>

<h4 class="mt-3">区间结果</h4>
<div class="table-responsive mb-4">
    <table class="table table-striped table-sm" id="tblRange">
        <thead class="table-light">
            <tr>
                <th>Rank</th>
                <th>CustomerId</th>
                <th>Score</th>
                <th style="width:180px">操作</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<button id="btnExport" class="btn btn-sm btn-outline-secondary mb-2">导出当前区间 CSV</button>

<h4>邻居结果</h4>
<div class="table-responsive">
    <table class="table table-bordered table-sm" id="tblNeighbors">
        <thead class="table-light">
            <tr>
                <th>Rank</th>
                <th>CustomerId</th>
                <th>Score</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

@section Scripts {
    <script src="~/js/leaderboard.js"></script>
}